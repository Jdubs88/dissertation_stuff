-- setup alternatives table
drop table if exists iowa.price_matrix_month_0001_wide;
create table iowa.price_matrix_month_0001_wide
(year int,
month int,
state_cost_364472674 numeric, 
state_cost_648652045 numeric, 
state_cost_444561561 numeric, 
state_cost_43128482 numeric, 
state_cost_311673458 numeric, 
state_cost_56840464 numeric, 
state_cost_54646335 numeric, 
state_cost_156272824 numeric, 
state_cost_124791071 numeric, 
state_cost_265862175 numeric, 
state_cost_778424689 numeric, 
state_cost_178261887 numeric, 
state_cost_481062503 numeric, 
state_cost_16516267 numeric, 
state_cost_268202791 numeric, 
state_cost_432191119 numeric, 
state_cost_891972979 numeric, 
state_cost_43116455 numeric, 
state_cost_299982072 numeric, 
state_cost_29288550 numeric, 
state_cost_42006282 numeric, 
state_cost_544483801 numeric, 
state_cost_699464356 numeric, 
state_cost_828201723 numeric, 
state_cost_108361481 numeric, 
state_cost_376404291 numeric, 
state_cost_43031437 numeric, 
state_cost_403133619 numeric, 
state_cost_804564370 numeric, 
state_cost_88283243 numeric, 
state_cost_28088582 numeric, 
state_cost_102785180 numeric, 
state_cost_232781030 numeric, 
state_cost_686113450 numeric, 
state_cost_876431990 numeric, 
state_cost_108051512 numeric, 
state_cost_369683635 numeric, 
state_cost_434091115 numeric, 
state_cost_106251054 numeric, 
state_cost_432441094 numeric, 
state_cost_696561822 numeric, 
state_cost_452773854 numeric, 
state_cost_752123110 numeric, 
state_cost_696371814 numeric, 
state_cost_561963916 numeric, 
state_cost_521861292 numeric, 
state_cost_868844758 numeric, 
state_cost_363042475 numeric, 
state_cost_47161262 numeric, 
state_cost_191122890 numeric, 
state_cost_268282790 numeric, 
state_cost_303172320 numeric, 
state_cost_652482816 numeric, 
state_cost_108081510 numeric, 
state_cost_190262884 numeric, 
state_cost_124671074 numeric, 
state_cost_856063806 numeric, 
state_cost_34029146 numeric, 
state_cost_359162076 numeric, 
state_cost_675573069 numeric, 
state_cost_747822800 numeric, 
state_cost_88253245 numeric, 
state_cost_730514350 numeric, 
state_cost_752083115 numeric, 
state_cost_256164478 numeric, 
state_cost_34008178 numeric, 
state_cost_34026169 numeric, 
state_cost_525991868 numeric, 
state_cost_550873802 numeric, 
state_cost_349955017 numeric, 
state_cost_299932071 numeric, 
state_cost_434261790 numeric, 
state_cost_891992978 numeric, 
state_cost_124781072 numeric, 
state_cost_444191536 numeric, 
state_cost_13774351 numeric, 
state_cost_34061172 numeric, 
state_cost_445201565 numeric, 
state_cost_8417089 numeric, 
state_cost_879373012 numeric, 
state_cost_2870505 numeric, 
state_cost_739861750 numeric, 
state_cost_894963405 numeric, 
state_cost_128884281 numeric, 
state_cost_405993626 numeric, 
state_cost_401933622 numeric, 
state_cost_550843804 numeric, 
state_cost_550883805 numeric, 
state_cost_648682043 numeric, 
state_cost_895331989 numeric, 
state_cost_270271374 numeric, 
state_cost_9885364401 numeric, 
state_cost_69981351 numeric, 
state_cost_236262086 numeric, 
state_cost_649962135 numeric, 
state_cost_34162614 numeric, 
state_cost_106261050 numeric, 
state_cost_275624505 numeric, 
state_cost_34030147 numeric, 
state_cost_413605215 numeric, 
state_cost_43127478 numeric, 
state_cost_417964664 numeric, 
state_cost_893883011 numeric, 
state_cost_363072473 numeric, 
state_cost_652582813 numeric, 
state_cost_882963898 numeric, 
state_cost_416255207 numeric, 
state_cost_363012478 numeric, 
state_cost_379364564 numeric, 
state_cost_43037431 numeric, 
state_cost_11773688 numeric, 
state_cost_215974940 numeric, 
state_cost_588382962 numeric, 
state_cost_647761385 numeric, 
state_cost_369763644 numeric, 
state_cost_378884513 numeric, 
state_cost_409654718 numeric, 
state_cost_446032066 numeric, 
state_cost_571571246 numeric, 
state_cost_891211179 numeric, 
state_cost_43145469 numeric, 
state_cost_648672039 numeric, 
state_cost_731361254 numeric, 
state_cost_735171645 numeric, 
state_cost_730504347 numeric, 
state_cost_379944707 numeric, 
state_cost_35416952 numeric, 
state_cost_68049509 numeric, 
state_cost_43156402 numeric, 
state_cost_433021096 numeric, 
state_cost_734561684 numeric, 
state_cost_752143108 numeric, 
state_cost_124081067 numeric, 
state_cost_349355042 numeric, 
state_cost_800961711 numeric, 
state_cost_696381817 numeric, 
state_cost_433331137 numeric, 
state_cost_525981863 numeric, 
state_cost_35316556 numeric, 
state_cost_446573204 numeric, 
state_cost_126681083 numeric, 
state_cost_624203414 numeric, 
state_cost_875961916 numeric, 
state_cost_762273543 numeric, 
state_cost_891932981 numeric, 
state_cost_43137443 numeric, 
state_cost_22291300 numeric, 
state_cost_405943615 numeric, 
state_cost_106271048 numeric, 
state_cost_434101116 numeric, 
state_cost_826101669 numeric, 
state_cost_53492951 numeric, 
state_cost_332564494 numeric, 
state_cost_359142077 numeric, 
state_cost_521461289 numeric, 
state_cost_34116159 numeric, 
state_cost_124061065 numeric, 
state_cost_828461681 numeric, 
state_cost_862503016 numeric, 
state_cost_43138448 numeric, 
state_cost_454194019 numeric, 
state_cost_866692777 numeric, 
state_cost_43123481 numeric, 
state_cost_369693633 numeric, 
state_cost_6144352 numeric, 
state_cost_588752994 numeric, 
state_cost_898372618 numeric, 
state_cost_270562907 numeric, 
state_cost_811963839 numeric, 
state_cost_846174003 numeric, 
state_cost_16518268 numeric, 
state_cost_415002465 numeric, 
state_cost_314733605 numeric, 
state_cost_773754673 numeric, 
state_cost_54863315 numeric, 
state_cost_348814855 numeric, 
state_cost_588602998 numeric, 
state_cost_777355268 numeric, 
state_cost_322364483 numeric, 
state_cost_417045220 numeric, 
state_cost_113484509 numeric, 
state_cost_433381135 numeric, 
state_cost_41320957 numeric, 
state_cost_202483690 numeric, 
state_cost_41299880 numeric, 
state_cost_68037498 numeric, 
state_cost_81966346 numeric, 
state_cost_268272787 numeric, 
state_cost_784563813 numeric, 
state_cost_588722960 numeric, 
state_cost_481042504 numeric, 
state_cost_379914710 numeric, 
state_cost_300562090 numeric, 
state_cost_303182322 numeric, 
state_cost_826061716 numeric, 
state_cost_405933617 numeric, 
state_cost_43120477 numeric, 
state_cost_314743603 numeric, 
state_cost_588732971 numeric, 
state_cost_868884776 numeric, 
state_cost_124071064 numeric, 
state_cost_874851780 numeric, 
state_cost_898875089 numeric, 
state_cost_48681749 numeric, 
state_cost_839063438 numeric, 
state_cost_892781907 numeric, 
state_cost_374174133 numeric, 
state_cost_190612905 numeric, 
state_cost_773184326 numeric, 
state_cost_11776686 numeric, 
state_cost_273922903 numeric, 
state_cost_366683146 numeric, 
state_cost_345784107 numeric, 
state_cost_491864248 numeric, 
state_cost_571741250 numeric, 
state_cost_341981344 numeric, 
state_cost_866702776 numeric, 
state_cost_215954944 numeric, 
state_cost_550663565 numeric, 
state_cost_361882325 numeric, 
state_cost_525821873 numeric, 
state_cost_190662873 numeric, 
state_cost_241562463 numeric, 
state_cost_343682147 numeric, 
state_cost_69971349 numeric, 
state_cost_322314488 numeric, 
state_cost_648662041 numeric, 
state_cost_55963447 numeric, 
state_cost_314723602 numeric, 
state_cost_381785066 numeric, 
state_cost_215984943 numeric, 
state_cost_141923976 numeric, 
state_cost_740862313 numeric, 
state_cost_868854775 numeric, 
state_cost_9369673634 numeric, 
state_cost_730534345 numeric, 
state_cost_406044636 numeric, 
state_cost_4356521 numeric, 
state_cost_22787569 numeric, 
state_cost_647111326 numeric, 
state_cost_28087579 numeric, 
state_cost_427123353 numeric, 
state_cost_881473546 numeric, 
state_cost_41840902 numeric, 
state_cost_190672872 numeric, 
state_cost_433161127 numeric, 
state_cost_465043156 numeric, 
state_cost_696111809 numeric, 
state_cost_764873794 numeric, 
state_cost_828661729 numeric, 
state_cost_35418953 numeric, 
state_cost_43136446 numeric, 
state_cost_409264670 numeric, 
state_cost_344332416 numeric, 
state_cost_11771692 numeric, 
state_cost_433281141 numeric, 
state_cost_681261155 numeric, 
state_cost_808262658 numeric, 
state_cost_347864825 numeric, 
state_cost_82147356 numeric, 
state_cost_156282827 numeric, 
state_cost_379864600 numeric, 
state_cost_202473688 numeric, 
state_cost_322334486 numeric, 
state_cost_17086850 numeric, 
state_cost_54057331 numeric, 
state_cost_868834760 numeric, 
state_cost_416815221 numeric, 
state_cost_481052499 numeric, 
state_cost_591001960 numeric, 
state_cost_404115227 numeric, 
state_cost_275852626 numeric, 
state_cost_433351138 numeric, 
state_cost_588762993 numeric, 
state_cost_68036500 numeric, 
state_cost_620973829 numeric, 
state_cost_826071715 numeric, 
state_cost_112931487 numeric, 
state_cost_322324485 numeric, 
state_cost_57092420 numeric, 
state_cost_523171287 numeric, 
state_cost_571611240 numeric, 
state_cost_420795195 numeric, 
state_cost_423123372 numeric, 
state_cost_532183915 numeric, 
state_cost_826261648 numeric, 
state_cost_696361815 numeric, 
state_cost_867964779 numeric, 
state_cost_11788689 numeric, 
state_cost_113464508 numeric, 
state_cost_156262825 numeric, 
state_cost_373385241 numeric, 
state_cost_417464623 numeric, 
state_cost_421663588 numeric, 
state_cost_420025194 numeric, 
state_cost_178301888 numeric, 
state_cost_53462949 numeric, 
state_cost_53272929 numeric, 
state_cost_130361080 numeric, 
state_cost_156774143 numeric, 
state_cost_421673587 numeric, 
state_cost_893873009 numeric, 
state_cost_221565319 numeric, 
state_cost_902836770 numeric, 
state_cost_887675098 numeric, 
state_cost_316543821 numeric, 
state_cost_43121483 numeric, 
state_cost_532103914 numeric, 
state_cost_34006175 numeric, 
state_cost_347484849 numeric, 
state_cost_379974705 numeric, 
state_cost_344232415 numeric, 
state_cost_433881170 numeric, 
state_cost_525801874 numeric, 
state_cost_812043837 numeric, 
state_cost_861121724 numeric, 
state_cost_418064700 numeric, 
state_cost_826111670 numeric, 
state_cost_80574352 numeric, 
state_cost_374164134 numeric, 
state_cost_547061635 numeric, 
state_cost_887685100 numeric, 
state_cost_34052171 numeric, 
state_cost_516964816 numeric, 
state_cost_647551338 numeric, 
state_cost_828401700 numeric, 
state_cost_190642874 numeric, 
state_cost_828671728 numeric, 
state_cost_866932770 numeric, 
state_cost_43126479 numeric, 
state_cost_696341816 numeric, 
state_cost_27474650 numeric, 
state_cost_28236769 numeric, 
state_cost_827871639 numeric, 
state_cost_696581823 numeric, 
state_cost_650662318 numeric, 
state_cost_648632042 numeric, 
state_cost_194773333 numeric, 
state_cost_288684918 numeric, 
state_cost_43209415 numeric, 
state_cost_56846465 numeric, 
state_cost_433311136 numeric, 
state_cost_646011145 numeric, 
state_cost_52892748 numeric, 
state_cost_373365237 numeric, 
state_cost_347464848 numeric, 
state_cost_300362067 numeric, 
state_cost_652004948 numeric, 
state_cost_798163816 numeric, 
state_cost_624053409 numeric, 
state_cost_641361756 numeric, 
state_cost_525941866 numeric, 
state_cost_34001179 numeric, 
state_cost_238232083 numeric, 
state_cost_647121331 numeric, 
state_cost_433871168 numeric, 
state_cost_190682877 numeric, 
state_cost_41284608 numeric, 
state_cost_152485359 numeric, 
state_cost_452483827 numeric, 
state_cost_202463689 numeric, 
state_cost_620613048 numeric, 
state_cost_336634891 numeric, 
state_cost_481032505 numeric, 
state_cost_373474014 numeric, 
state_cost_571201242 numeric, 
state_cost_43027213 numeric, 
state_cost_409564691 numeric, 
state_cost_50362273 numeric, 
state_cost_410772862 numeric, 
state_cost_275444212 numeric, 
state_cost_523141284 numeric, 
state_cost_897874409 numeric, 
state_cost_275544501 numeric, 
state_cost_133883651 numeric, 
state_cost_651272341 numeric, 
state_cost_359132078 numeric, 
state_cost_648702047 numeric, 
state_cost_752103114 numeric, 
state_cost_866722775 numeric, 
state_cost_112981488 numeric, 
state_cost_237082092 numeric, 
state_cost_409464717 numeric, 
state_cost_774724901 numeric, 
state_cost_22786570 numeric, 
state_cost_491894249 numeric, 
state_cost_373484017 numeric, 
state_cost_806871637 numeric, 
state_cost_50372272 numeric, 
state_cost_34007174 numeric, 
state_cost_44258701 numeric, 
state_cost_244663089 numeric, 
state_cost_891942977 numeric, 
state_cost_44217554 numeric, 
state_cost_670063521 numeric, 
state_cost_184072158 numeric, 
state_cost_374264138 numeric, 
state_cost_41316966 numeric, 
state_cost_777745327 numeric, 
state_cost_256064473 numeric, 
state_cost_341641324 numeric, 
state_cost_80578354 numeric, 
state_cost_868814774 numeric, 
state_cost_675283044 numeric, 
state_cost_56957542 numeric, 
state_cost_11588694 numeric, 
state_cost_624003402 numeric, 
state_cost_316583822 numeric, 
state_cost_409764615 numeric, 
state_cost_53472952 numeric, 
state_cost_379884601 numeric, 
state_cost_635284382 numeric, 
state_cost_868864757 numeric, 
state_cost_465063157 numeric, 
state_cost_652512814 numeric, 
state_cost_299962069 numeric, 
state_cost_730554344 numeric, 
state_cost_804574369 numeric, 
state_cost_172061186 numeric, 
state_cost_417835190 numeric, 
state_cost_314753601 numeric, 
state_cost_777404660 numeric, 
state_cost_9046891337 numeric, 
state_cost_108071511 numeric, 
state_cost_875861912 numeric, 
state_cost_417154626 numeric, 
state_cost_215964941 numeric, 
state_cost_241572462 numeric, 
state_cost_879363013 numeric, 
state_cost_43205458 numeric, 
state_cost_64336401 numeric, 
state_cost_380884122 numeric, 
state_cost_477861438 numeric, 
state_cost_561953918 numeric, 
state_cost_416925185 numeric, 
state_cost_551063991 numeric, 
state_cost_826361667 numeric, 
state_cost_43026214 numeric, 
state_cost_432871118 numeric, 
state_cost_828471697 numeric, 
state_cost_43035438 numeric, 
state_cost_415924639 numeric, 
state_cost_56828417 numeric, 
state_cost_136383284 numeric, 
state_cost_571581251 numeric, 
state_cost_108902109 numeric, 
state_cost_826181673 numeric, 
state_cost_222135384 numeric, 
state_cost_347474844 numeric, 
state_cost_427033371 numeric, 
state_cost_874092984 numeric, 
state_cost_43117454 numeric, 
state_cost_80577350 numeric, 
state_cost_192263131 numeric, 
state_cost_416045206 numeric, 
state_cost_297281031 numeric, 
state_cost_379374563 numeric, 
state_cost_302382197 numeric, 
state_cost_303162321 numeric, 
state_cost_369083470 numeric, 
state_cost_10555696 numeric, 
state_cost_112901489 numeric, 
state_cost_381775064 numeric, 
state_cost_417073998 numeric, 
state_cost_637554961 numeric, 
state_cost_899165095 numeric, 
state_cost_152475357 numeric, 
state_cost_232771028 numeric, 
state_cost_341971322 numeric, 
state_cost_22783572 numeric, 
state_cost_43125484 numeric, 
state_cost_426873343 numeric, 
state_cost_433861169 numeric, 
state_cost_16676562 numeric, 
state_cost_16987789 numeric, 
state_cost_57051553 numeric, 
state_cost_359262073 numeric, 
state_cost_299942070 numeric, 
state_cost_463512471 numeric, 
state_cost_458864376 numeric, 
state_cost_550683566 numeric, 
state_cost_410782865 numeric, 
state_cost_317183995 numeric, 
state_cost_11786699 numeric, 
state_cost_238272080 numeric, 
state_cost_244573083 numeric, 
state_cost_344493093 numeric, 
state_cost_348214898 numeric, 
state_cost_378864512 numeric, 
state_cost_897884411 numeric, 
state_cost_11586693 numeric, 
state_cost_588682969 numeric, 
state_cost_879973197 numeric, 
state_cost_286252492 numeric, 
state_cost_760383514 numeric, 
state_cost_433371133 numeric, 
state_cost_80571355 numeric, 
state_cost_312083459 numeric, 
state_cost_380064712 numeric, 
state_cost_764863795 numeric, 
state_cost_833632660 numeric, 
state_cost_18006841 numeric, 
state_cost_82082628 numeric, 
state_cost_43024215 numeric, 
state_cost_52882750 numeric, 
state_cost_11777685 numeric, 
state_cost_17991132 numeric, 
state_cost_43025219 numeric, 
state_cost_349725007 numeric, 
state_cost_672675509 numeric, 
state_cost_764883796 numeric, 
state_cost_88273241 numeric, 
state_cost_300572089 numeric, 
state_cost_804584371 numeric, 
state_cost_814065047 numeric, 
state_cost_244543085 numeric, 
state_cost_344252418 numeric, 
state_cost_416985210 numeric, 
state_cost_268212792 numeric, 
state_cost_647161327 numeric, 
state_cost_348174871 numeric, 
state_cost_438484334 numeric, 
state_cost_322354489 numeric, 
state_cost_571291244 numeric, 
state_cost_882943897 numeric, 
state_cost_752163111 numeric, 
state_cost_54056332 numeric, 
state_cost_434151107 numeric, 
state_cost_760443513 numeric, 
state_cost_452463826 numeric, 
state_cost_571481243 numeric, 
state_cost_52902749 numeric, 
state_cost_316563820 numeric, 
state_cost_374184137 numeric, 
state_cost_35317555 numeric, 
state_cost_43050426 numeric, 
state_cost_34155616 numeric, 
state_cost_359645019 numeric, 
state_cost_432821121 numeric, 
state_cost_56063448 numeric, 
state_cost_322384487 numeric, 
state_cost_345663961 numeric, 
state_cost_416535202 numeric, 
state_cost_401181854 numeric, 
state_cost_49361993 numeric, 
state_cost_100094431 numeric, 
state_cost_839073437 numeric, 
state_cost_443501003 numeric, 
state_cost_152965362 numeric, 
state_cost_379964706 numeric, 
state_cost_427173349 numeric, 
state_cost_646761226 numeric, 
state_cost_477851437 numeric, 
state_cost_588852997 numeric, 
state_cost_29568893 numeric, 
state_cost_71886256 numeric, 
state_cost_767673999 numeric, 
state_cost_361862324 numeric, 
state_cost_410762864 numeric, 
state_cost_36572532 numeric, 
state_cost_344563096 numeric, 
state_cost_119361068 numeric, 
state_cost_356264111 numeric, 
state_cost_897864410 numeric, 
state_cost_696661833 numeric, 
state_cost_778524716 numeric, 
state_cost_699474354 numeric, 
state_cost_348234877 numeric, 
state_cost_369073471 numeric, 
state_cost_79026343 numeric, 
state_cost_322344484 numeric, 
state_cost_379344565 numeric, 
state_cost_379384566 numeric, 
state_cost_8751020 numeric, 
state_cost_50062247 numeric, 
state_cost_892421420 numeric, 
state_cost_369043469 numeric, 
state_cost_1573935 numeric, 
state_cost_34014137 numeric, 
state_cost_300582091 numeric, 
state_cost_406325242 numeric, 
state_cost_525971869 numeric, 
state_cost_100084433 numeric, 
state_cost_5915426 numeric, 
state_cost_43066467 numeric, 
state_cost_80576351 numeric, 
state_cost_181961984 numeric, 
state_cost_633554549 numeric, 
state_cost_760423511 numeric, 
state_cost_53262930 numeric, 
state_cost_826371666 numeric, 
state_cost_675863071 numeric, 
state_cost_452763855 numeric, 
state_cost_35315561 numeric, 
state_cost_481022508 numeric, 
state_cost_828491699 numeric, 
state_cost_369013468 numeric, 
state_cost_544463799 numeric, 
state_cost_463502472 numeric, 
state_cost_179561971 numeric, 
state_cost_827861643 numeric, 
state_cost_666364310 numeric, 
state_cost_68039501 numeric, 
state_cost_651262343 numeric, 
state_cost_373395239 numeric, 
state_cost_734190 numeric, 
state_cost_699454355 numeric, 
state_cost_108181507 numeric, 
state_cost_892153005 numeric, 
state_cost_89139984 numeric, 
state_cost_490864235 numeric, 
state_cost_525961862 numeric, 
state_cost_788663814 numeric, 
state_cost_869164762 numeric, 
state_cost_417055219 numeric, 
state_cost_648622040 numeric, 
state_cost_43076208 numeric, 
state_cost_221215325 numeric, 
state_cost_244583087 numeric, 
state_cost_525631877 numeric, 
state_cost_639635214 numeric, 
state_cost_879383014 numeric, 
state_cost_247063452 numeric, 
state_cost_777765329 numeric, 
state_cost_184082159 numeric, 
state_cost_446583206 numeric, 
state_cost_887665099 numeric, 
state_cost_668364802 numeric, 
state_cost_56850463 numeric, 
state_cost_424444531 numeric, 
state_cost_412092062 numeric, 
state_cost_891982982 numeric, 
state_cost_406255200 numeric, 
state_cost_368873467 numeric, 
state_cost_895773544 numeric, 
state_cost_221555322 numeric, 
state_cost_544363564 numeric, 
state_cost_633594561 numeric, 
state_cost_894473195 numeric, 
state_cost_373564018 numeric, 
state_cost_532113924 numeric, 
state_cost_865073846 numeric, 
state_cost_14001522 numeric, 
state_cost_202863693 numeric, 
state_cost_344583097 numeric, 
state_cost_432961130 numeric, 
state_cost_35354162 numeric, 
state_cost_359442095 numeric, 
state_cost_369743645 numeric, 
state_cost_844563834 numeric, 
state_cost_179161934 numeric, 
state_cost_54647334 numeric, 
state_cost_305272467 numeric, 
state_cost_675563070 numeric, 
state_cost_652532812 numeric, 
state_cost_68022508 numeric, 
state_cost_865063847 numeric, 
state_cost_764783788 numeric, 
state_cost_48661746 numeric, 
state_cost_588011108 numeric, 
state_cost_268242793 numeric, 
state_cost_10549698 numeric, 
state_cost_349195043 numeric, 
state_cost_43077207 numeric, 
state_cost_181981986 numeric, 
state_cost_34036168 numeric, 
state_cost_247283453 numeric, 
state_cost_648761840 numeric, 
state_cost_828271708 numeric, 
state_cost_429845112 numeric, 
state_cost_651952633 numeric, 
state_cost_403945197 numeric, 
state_cost_812083838 numeric, 
state_cost_221575318 numeric, 
state_cost_22788573 numeric, 
state_cost_808272657 numeric, 
state_cost_420095196 numeric, 
state_cost_458874375 numeric, 
state_cost_590371737 numeric, 
state_cost_804404276 numeric, 
state_cost_156442826 numeric, 
state_cost_359462094 numeric, 
state_cost_681271154 numeric, 
state_cost_88263244 numeric, 
state_cost_773784677 numeric, 
state_cost_43984204 numeric, 
state_cost_288674914 numeric, 
state_cost_735261686 numeric, 
state_cost_17127981 numeric, 
state_cost_369783647 numeric, 
state_cost_812063836 numeric, 
state_cost_588402957 numeric, 
state_cost_124041066 numeric, 
state_cost_130381081 numeric, 
state_cost_346904740 numeric, 
state_cost_130371079 numeric, 
state_cost_21480620 numeric, 
state_cost_532143913 numeric, 
state_cost_730544346 numeric, 
state_cost_452473825 numeric, 
state_cost_874082985 numeric, 
state_cost_82127348 numeric, 
state_cost_159405139 numeric, 
state_cost_562063832 numeric, 
state_cost_696571821 numeric, 
state_cost_812073835 numeric, 
state_cost_777865135 numeric, 
state_cost_444991554 numeric, 
state_cost_445161553 numeric, 
state_cost_891541783 numeric, 
state_cost_828261702 numeric, 
state_cost_316573819 numeric, 
state_cost_669362356 numeric, 
state_cost_891912983 numeric, 
state_cost_433361110 numeric, 
state_cost_806861638 numeric, 
state_cost_238262081 numeric, 
state_cost_359172075 numeric, 
state_cost_891962980 numeric, 
state_cost_4626831 numeric, 
state_cost_359482096 numeric, 
state_cost_194783336 numeric, 
state_cost_844963844 numeric, 
state_cost_34021113 numeric, 
state_cost_379984709 numeric, 
state_cost_588362961 numeric, 
state_cost_40482820 numeric, 
state_cost_43038436 numeric, 
state_cost_94283878 numeric, 
state_cost_241582464 numeric, 
state_cost_356284112 numeric, 
state_cost_433341134 numeric, 
state_cost_648642046 numeric, 
state_cost_302362196 numeric, 
state_cost_491854246 numeric, 
state_cost_525951870 numeric, 
state_cost_532133912 numeric, 
state_cost_194863332 numeric, 
state_cost_452783857 numeric, 
state_cost_68038502 numeric, 
state_cost_269062795 numeric, 
state_cost_374144135 numeric, 
state_cost_405923616 numeric, 
state_cost_427183352 numeric, 
state_cost_8920617 numeric, 
state_cost_56958543 numeric, 
state_cost_416945182 numeric, 
state_cost_16988790 numeric, 
state_cost_322374482 numeric, 
state_cost_190822906 numeric, 
state_cost_844573833 numeric, 
state_cost_426663583 numeric, 
state_cost_268262788 numeric, 
state_cost_525931865 numeric, 
state_cost_92783722 numeric, 
state_cost_41279896 numeric, 
state_cost_528353142 numeric, 
state_cost_760363507 numeric, 
state_cost_374134136 numeric, 
state_cost_571441252 numeric, 
state_cost_750873008 numeric, 
state_cost_419895193 numeric, 
state_cost_43986205 numeric, 
state_cost_10553690 numeric, 
state_cost_305262468 numeric, 
state_cost_672665510 numeric, 
state_cost_27025847 numeric, 
state_cost_34117158 numeric, 
state_cost_802362680 numeric, 
state_cost_31352818 numeric, 
state_cost_592312659 numeric, 
state_cost_317193994 numeric, 
state_cost_828811672 numeric, 
state_cost_406144352 numeric, 
state_cost_647361348 numeric, 
state_cost_588862996 numeric, 
state_cost_675273041 numeric, 
state_cost_258764867 numeric, 
state_cost_896174404 numeric, 
state_cost_10548697 numeric, 
state_cost_113474507 numeric, 
state_cost_152465358 numeric, 
state_cost_506864806 numeric, 
state_cost_833702664 numeric, 
state_cost_379874598 numeric, 
state_cost_256084476 numeric, 
state_cost_774875094 numeric, 
state_cost_760403520 numeric, 
state_cost_458844377 numeric, 
state_cost_588352963 numeric, 
state_cost_765263831 numeric, 
state_cost_124761073 numeric, 
state_cost_256034475 numeric, 
state_cost_22784571 numeric, 
state_cost_305282469 numeric, 
state_cost_525811875 numeric, 
state_cost_28206761 numeric, 
state_cost_372173850 numeric, 
state_cost_427163350 numeric, 
state_cost_866922771 numeric, 
state_cost_675263042 numeric, 
state_cost_898362619 numeric, 
state_cost_337173841 numeric, 
state_cost_359182079 numeric, 
state_cost_645731333 numeric, 
state_cost_55246362 numeric, 
state_cost_523121283 numeric, 
state_cost_94263877 numeric, 
state_cost_880363412 numeric, 
state_cost_571251241 numeric, 
state_cost_28086580 numeric, 
state_cost_112971485 numeric, 
state_cost_34032148 numeric, 
state_cost_368863465 numeric, 
state_cost_454184020 numeric, 
state_cost_826271647 numeric, 
state_cost_41271111 numeric, 
state_cost_43046475 numeric, 
state_cost_696671832 numeric, 
state_cost_868074765 numeric, 
state_cost_190632876 numeric, 
state_cost_274791372 numeric, 
state_cost_417194633 numeric, 
state_cost_652572808 numeric, 
state_cost_868874756 numeric, 
state_cost_43022218 numeric, 
state_cost_268232789 numeric, 
state_cost_862513015 numeric, 
state_cost_402973593 numeric, 
state_cost_647591339 numeric, 
state_cost_316663823 numeric, 
state_cost_398664701 numeric, 
state_cost_256044474 numeric, 
state_cost_368711323 numeric, 
state_cost_363082477 numeric, 
state_cost_433301142 numeric, 
state_cost_793363815 numeric, 
state_cost_652562809 numeric, 
state_cost_458884378 numeric, 
state_cost_633574553 numeric, 
state_cost_369033466 numeric, 
state_cost_34076184 numeric, 
state_cost_379354567 numeric, 
state_cost_635304384 numeric, 
state_cost_855261710 numeric, 
state_cost_11774687 numeric, 
state_cost_256074472 numeric, 
state_cost_348714847 numeric, 
state_cost_829572064 numeric, 
state_cost_426993362 numeric, 
state_cost_683061942 numeric, 
state_cost_381765067 numeric, 
state_cost_33102819 numeric, 
state_cost_885564398 numeric, 
state_cost_452453828 numeric, 
state_cost_891751778 numeric, 
state_cost_737151958 numeric, 
state_cost_376424292 numeric, 
state_cost_345794105 numeric, 
state_cost_434181139 numeric, 
state_cost_369713637 numeric, 
state_cost_416935184 numeric, 
state_cost_417015211 numeric, 
state_cost_141993977 numeric, 
state_cost_348204895 numeric, 
state_cost_124641076 numeric, 
state_cost_238282084 numeric, 
state_cost_893863010 numeric, 
state_cost_72816991 numeric, 
state_cost_179581973 numeric, 
state_cost_863903545 numeric, 
state_cost_844863807 numeric, 
state_cost_56843466 numeric, 
state_cost_222165385 numeric, 
state_cost_9465743475 numeric, 
state_cost_41413922 numeric, 
state_cost_190962911 numeric, 
state_cost_480992500 numeric, 
state_cost_9368593476 numeric, 
state_cost_34004177 numeric, 
state_cost_100064432 numeric, 
state_cost_405983628 numeric, 
state_cost_639595188 numeric, 
state_cost_371463754 numeric, 
state_cost_106281053 numeric, 
state_cost_274102893 numeric, 
state_cost_651994947 numeric, 
state_cost_258784869 numeric, 
state_cost_244563084 numeric, 
state_cost_348564927 numeric, 
state_cost_416015183 numeric, 
state_cost_523161282 numeric, 
state_cost_426763366 numeric, 
state_cost_699404353 numeric, 
state_cost_10550695 numeric, 
state_cost_15776973 numeric, 
state_cost_271024938 numeric, 
state_cost_523191286 numeric, 
state_cost_652542810 numeric, 
state_cost_35318559 numeric, 
state_cost_356993944 numeric, 
state_cost_41927891 numeric, 
state_cost_344573094 numeric, 
state_cost_352134741 numeric, 
state_cost_48671745 numeric, 
state_cost_343662146 numeric, 
state_cost_550863803 numeric, 
state_cost_128564285 numeric, 
state_cost_760323516 numeric, 
state_cost_28233766 numeric, 
state_cost_112941486 numeric, 
state_cost_113661518 numeric, 
state_cost_778474697 numeric, 
state_cost_16517266 numeric, 
state_cost_357804051 numeric, 
state_cost_359472093 numeric, 
state_cost_555063810 numeric, 
state_cost_863103198 numeric, 
state_cost_343592414 numeric, 
state_cost_380084711 numeric, 
state_cost_528063140 numeric, 
state_cost_43028216 numeric, 
state_cost_532163911 numeric, 
state_cost_266562181 numeric, 
state_cost_737021965 numeric, 
state_cost_112961476 numeric, 
state_cost_258774866 numeric, 
state_cost_366673145 numeric, 
state_cost_416885191 numeric, 
state_cost_544473798 numeric, 
state_cost_866375097 numeric, 
state_cost_373464016 numeric, 
state_cost_43197488 numeric, 
state_cost_82126349 numeric, 
state_cost_288904925 numeric, 
state_cost_274541302 numeric, 
state_cost_29287548 numeric, 
state_cost_730524343 numeric, 
state_cost_801452153 numeric, 
state_cost_452753858 numeric, 
state_cost_124661075 numeric, 
state_cost_363052474 numeric, 
state_cost_43048476 numeric, 
state_cost_82187359 numeric, 
state_cost_299972068 numeric, 
state_cost_337163842 numeric, 
state_cost_43036432 numeric, 
state_cost_47171261 numeric, 
state_cost_288664915 numeric, 
state_cost_379934708 numeric, 
state_cost_773954559 numeric, 
state_cost_523181285 numeric, 
state_cost_416965209 numeric, 
state_cost_418461979 numeric, 
state_cost_417974663 numeric, 
state_cost_345463959 numeric, 
state_cost_268222784 numeric, 
state_cost_727221293 numeric, 
state_cost_194763335 numeric, 
state_cost_43051427 numeric, 
state_cost_444761542 numeric, 
state_cost_588422975 numeric, 
state_cost_29566892 numeric, 
state_cost_287184070 numeric, 
state_cost_344222417 numeric, 
state_cost_417474622 numeric, 
state_cost_43124480 numeric, 
state_cost_238242082 numeric, 
state_cost_409304631 numeric, 
state_cost_432851114 numeric, 
state_cost_688464799 numeric, 
state_cost_648582044 numeric, 
state_cost_764363723 numeric);
copy iowa.price_matrix_month_0001_wide
from 'C:\Users\JW\Documents\Iowa papers\discrete_price_matrix_monthly_0001_filled_state.csv'
delimiter ','
csv
header;

drop table if exists iowa.price_matrix_month_0001_long;
drop table if exists iowa.___temp;
select transpose('iowa.price_matrix_month_0001_wide', 'iowa.___temp','vertically',
		 'year, month','reduced_item_code',
		 'state_cost');
create table iowa.price_matrix_month_0001_long as
select year, month, cast(substring(reduced_item_code, 12, 50) as bigint) as reduced_item_code, cast(state_cost as numeric) as state_cost
from iowa.___temp;

drop table if exists iowa.___temp;



-- Make a long datset with filled-in zeroes
drop table if exists iowa.rf_dataset;
drop table if exists iowa.___temp;
select transpose('iowa.discrete_data_001_monthly_wide_maxvol', 'iowa.___temp','vertically',
		 'year, month, store_num, max_volume','reduced_item_code',
		 'volume_liters');
create table iowa.rf_dataset as 
select year, month, store_num, , case when cast(volume_liters as numeric) is null then 0 else cast(volume_liters as numeric) end as volume_liters
from iowa.___temp
order by store_num, year, month;

drop table if exists iowa.___temp;

drop table if exists iowa.rf_dataset_covariates;
create table iowa.rf_dataset_covariates as
select d.*, s.city_abd_proper, s.zip_code, s.county_abd, s.sell_gasoline, s.store_type, s.square_footage_whole, s.square_footage_retail, p.state_cost, case when p.state_cost = 0 then 0 else 1 end as available
from iowa.rf_dataset d
left join iowa.price_matrix_month_0001_long p
on d.reduced_item_code = p.reduced_item_code
and d.year = p.year
and d.month = p.month
left join iowa.store_info s
on d.store_num = s.store_num_abd;

copy (select *
      from iowa.rf_dataset_covariates
      order by store_num, year, month)
to 'C:\Users\JW\Documents\Iowa papers\rf_data.csv'
delimiter ','
csv
header;












-- Again, but with dummies instead of categoricals, to reduce the load on the RF algorithm
drop table if exists iowa.___temp;
select transpose('iowa.discrete_data_001_monthly_wide_maxvol', 'iowa.___temp','vertically',
		 'year, month, store_num, max_volume','reduced_item_code',
		 'volume_liters');
drop table if exists iowa.rf_dataset_indic;
create table iowa.rf_dataset_indic as 
select year, month, store_num, cast(substring(reduced_item_code,15,10) as bigint) as reduced_item_code,
case when cast(substring(reduced_item_code,15,10) as bigint) = 891972979 then 1 else 0 end as item_891972979,
case when cast(substring(reduced_item_code,15,10) as bigint) = 368863465 then 1 else 0 end as item_368863465,
case when cast(substring(reduced_item_code,15,10) as bigint) = 68037498 then 1 else 0 end as item_68037498,
case when cast(substring(reduced_item_code,15,10) as bigint) = 43127478 then 1 else 0 end as item_43127478,
case when cast(substring(reduced_item_code,15,10) as bigint) = 43027213 then 1 else 0 end as item_43027213,
case when cast(substring(reduced_item_code,15,10) as bigint) = 100084433 then 1 else 0 end as item_100084433,
case when cast(substring(reduced_item_code,15,10) as bigint) = 373464016 then 1 else 0 end as item_373464016,
case when cast(substring(reduced_item_code,15,10) as bigint) = 363042475 then 1 else 0 end as item_363042475,
case when cast(substring(reduced_item_code,15,10) as bigint) = 828471697 then 1 else 0 end as item_828471697,
case when cast(substring(reduced_item_code,15,10) as bigint) = 347474844 then 1 else 0 end as item_347474844,
case when cast(substring(reduced_item_code,15,10) as bigint) = 322384487 then 1 else 0 end as item_322384487,
case when cast(substring(reduced_item_code,15,10) as bigint) = 256084476 then 1 else 0 end as item_256084476,
case when cast(substring(reduced_item_code,15,10) as bigint) = 374174133 then 1 else 0 end as item_374174133,
case when cast(substring(reduced_item_code,15,10) as bigint) = 380884122 then 1 else 0 end as item_380884122,
case when cast(substring(reduced_item_code,15,10) as bigint) = 244573083 then 1 else 0 end as item_244573083,
case when cast(substring(reduced_item_code,15,10) as bigint) = 215984943 then 1 else 0 end as item_215984943,
case when cast(substring(reduced_item_code,15,10) as bigint) = 238272080 then 1 else 0 end as item_238272080,
case when cast(substring(reduced_item_code,15,10) as bigint) = 432851114 then 1 else 0 end as item_432851114,
case when cast(substring(reduced_item_code,15,10) as bigint) = 43026214 then 1 else 0 end as item_43026214,
case when cast(substring(reduced_item_code,15,10) as bigint) = 380084711 then 1 else 0 end as item_380084711,
case when cast(substring(reduced_item_code,15,10) as bigint) = 244583087 then 1 else 0 end as item_244583087,
case when cast(substring(reduced_item_code,15,10) as bigint) = 427173349 then 1 else 0 end as item_427173349,
case when cast(substring(reduced_item_code,15,10) as bigint) = 194773333 then 1 else 0 end as item_194773333,
case when cast(substring(reduced_item_code,15,10) as bigint) = 879373012 then 1 else 0 end as item_879373012,
case when cast(substring(reduced_item_code,15,10) as bigint) = 156262825 then 1 else 0 end as item_156262825,
case when cast(substring(reduced_item_code,15,10) as bigint) = 268282790 then 1 else 0 end as item_268282790,
case when cast(substring(reduced_item_code,15,10) as bigint) = 895773544 then 1 else 0 end as item_895773544,
case when cast(substring(reduced_item_code,15,10) as bigint) = 458864376 then 1 else 0 end as item_458864376,
case when cast(substring(reduced_item_code,15,10) as bigint) = 571481243 then 1 else 0 end as item_571481243,
case when cast(substring(reduced_item_code,15,10) as bigint) = 369033466 then 1 else 0 end as item_369033466,
case when cast(substring(reduced_item_code,15,10) as bigint) = 648662041 then 1 else 0 end as item_648662041,
case when cast(substring(reduced_item_code,15,10) as bigint) = 379384566 then 1 else 0 end as item_379384566,
case when cast(substring(reduced_item_code,15,10) as bigint) = 130381081 then 1 else 0 end as item_130381081,
case when cast(substring(reduced_item_code,15,10) as bigint) = 590371737 then 1 else 0 end as item_590371737,
case when cast(substring(reduced_item_code,15,10) as bigint) = 11786699 then 1 else 0 end as item_11786699,
case when cast(substring(reduced_item_code,15,10) as bigint) = 433371133 then 1 else 0 end as item_433371133,
case when cast(substring(reduced_item_code,15,10) as bigint) = 812073835 then 1 else 0 end as item_812073835,
case when cast(substring(reduced_item_code,15,10) as bigint) = 588682969 then 1 else 0 end as item_588682969,
case when cast(substring(reduced_item_code,15,10) as bigint) = 752143108 then 1 else 0 end as item_752143108,
case when cast(substring(reduced_item_code,15,10) as bigint) = 16518268 then 1 else 0 end as item_16518268,
case when cast(substring(reduced_item_code,15,10) as bigint) = 256064473 then 1 else 0 end as item_256064473,
case when cast(substring(reduced_item_code,15,10) as bigint) = 452483827 then 1 else 0 end as item_452483827,
case when cast(substring(reduced_item_code,15,10) as bigint) = 124081067 then 1 else 0 end as item_124081067,
case when cast(substring(reduced_item_code,15,10) as bigint) = 11586693 then 1 else 0 end as item_11586693,
case when cast(substring(reduced_item_code,15,10) as bigint) = 379974705 then 1 else 0 end as item_379974705,
case when cast(substring(reduced_item_code,15,10) as bigint) = 750873008 then 1 else 0 end as item_750873008,
case when cast(substring(reduced_item_code,15,10) as bigint) = 215974940 then 1 else 0 end as item_215974940,
case when cast(substring(reduced_item_code,15,10) as bigint) = 322364483 then 1 else 0 end as item_322364483,
case when cast(substring(reduced_item_code,15,10) as bigint) = 379944707 then 1 else 0 end as item_379944707,
case when cast(substring(reduced_item_code,15,10) as bigint) = 418461979 then 1 else 0 end as item_418461979,
case when cast(substring(reduced_item_code,15,10) as bigint) = 452763855 then 1 else 0 end as item_452763855,
case when cast(substring(reduced_item_code,15,10) as bigint) = 550863803 then 1 else 0 end as item_550863803,
case when cast(substring(reduced_item_code,15,10) as bigint) = 35318559 then 1 else 0 end as item_35318559,
case when cast(substring(reduced_item_code,15,10) as bigint) = 369713637 then 1 else 0 end as item_369713637,
case when cast(substring(reduced_item_code,15,10) as bigint) = 433381135 then 1 else 0 end as item_433381135,
case when cast(substring(reduced_item_code,15,10) as bigint) = 112961476 then 1 else 0 end as item_112961476,
case when cast(substring(reduced_item_code,15,10) as bigint) = 124071064 then 1 else 0 end as item_124071064,
case when cast(substring(reduced_item_code,15,10) as bigint) = 828671728 then 1 else 0 end as item_828671728,
case when cast(substring(reduced_item_code,15,10) as bigint) = 359142077 then 1 else 0 end as item_359142077,
case when cast(substring(reduced_item_code,15,10) as bigint) = 363082477 then 1 else 0 end as item_363082477,
case when cast(substring(reduced_item_code,15,10) as bigint) = 29287548 then 1 else 0 end as item_29287548,
case when cast(substring(reduced_item_code,15,10) as bigint) = 35418953 then 1 else 0 end as item_35418953,
case when cast(substring(reduced_item_code,15,10) as bigint) = 268272787 then 1 else 0 end as item_268272787,
case when cast(substring(reduced_item_code,15,10) as bigint) = 369783647 then 1 else 0 end as item_369783647,
case when cast(substring(reduced_item_code,15,10) as bigint) = 379984709 then 1 else 0 end as item_379984709,
case when cast(substring(reduced_item_code,15,10) as bigint) = 348214898 then 1 else 0 end as item_348214898,
case when cast(substring(reduced_item_code,15,10) as bigint) = 359172075 then 1 else 0 end as item_359172075,
case when cast(substring(reduced_item_code,15,10) as bigint) = 730534345 then 1 else 0 end as item_730534345,
case when cast(substring(reduced_item_code,15,10) as bigint) = 43038436 then 1 else 0 end as item_43038436,
case when cast(substring(reduced_item_code,15,10) as bigint) = 416935184 then 1 else 0 end as item_416935184,
case when cast(substring(reduced_item_code,15,10) as bigint) = 433351138 then 1 else 0 end as item_433351138,
case when cast(substring(reduced_item_code,15,10) as bigint) = 34008178 then 1 else 0 end as item_34008178,
case when cast(substring(reduced_item_code,15,10) as bigint) = 827871639 then 1 else 0 end as item_827871639,
case when cast(substring(reduced_item_code,15,10) as bigint) = 866702776 then 1 else 0 end as item_866702776,
case when cast(substring(reduced_item_code,15,10) as bigint) = 381785066 then 1 else 0 end as item_381785066,
case when cast(substring(reduced_item_code,15,10) as bigint) = 532143913 then 1 else 0 end as item_532143913,
case when cast(substring(reduced_item_code,15,10) as bigint) = 373365237 then 1 else 0 end as item_373365237,
case when cast(substring(reduced_item_code,15,10) as bigint) = 481062503 then 1 else 0 end as item_481062503,
case when cast(substring(reduced_item_code,15,10) as bigint) = 44217554 then 1 else 0 end as item_44217554,
case when cast(substring(reduced_item_code,15,10) as bigint) = 363072473 then 1 else 0 end as item_363072473,
case when cast(substring(reduced_item_code,15,10) as bigint) = 363052474 then 1 else 0 end as item_363052474,
case when cast(substring(reduced_item_code,15,10) as bigint) = 152485359 then 1 else 0 end as item_152485359,
case when cast(substring(reduced_item_code,15,10) as bigint) = 868884776 then 1 else 0 end as item_868884776,
case when cast(substring(reduced_item_code,15,10) as bigint) = 868874756 then 1 else 0 end as item_868874756,
case when cast(substring(reduced_item_code,15,10) as bigint) = 43136446 then 1 else 0 end as item_43136446,
case when cast(substring(reduced_item_code,15,10) as bigint) = 648652045 then 1 else 0 end as item_648652045,
case when cast(substring(reduced_item_code,15,10) as bigint) = 348204895 then 1 else 0 end as item_348204895,
case when cast(substring(reduced_item_code,15,10) as bigint) = 34029146 then 1 else 0 end as item_34029146,
case when cast(substring(reduced_item_code,15,10) as bigint) = 34006175 then 1 else 0 end as item_34006175,
case when cast(substring(reduced_item_code,15,10) as bigint) = 43128482 then 1 else 0 end as item_43128482,
case when cast(substring(reduced_item_code,15,10) as bigint) = 525981863 then 1 else 0 end as item_525981863,
case when cast(substring(reduced_item_code,15,10) as bigint) = 124781072 then 1 else 0 end as item_124781072,
case when cast(substring(reduced_item_code,15,10) as bigint) = 774875094 then 1 else 0 end as item_774875094,
case when cast(substring(reduced_item_code,15,10) as bigint) = 862513015 then 1 else 0 end as item_862513015,
case when cast(substring(reduced_item_code,15,10) as bigint) = 11788689 then 1 else 0 end as item_11788689,
case when cast(substring(reduced_item_code,15,10) as bigint) = 288664915 then 1 else 0 end as item_288664915,
case when cast(substring(reduced_item_code,15,10) as bigint) = 588722960 then 1 else 0 end as item_588722960,
case when cast(substring(reduced_item_code,15,10) as bigint) = 812083838 then 1 else 0 end as item_812083838,
case when cast(substring(reduced_item_code,15,10) as bigint) = 11773688 then 1 else 0 end as item_11773688,
case when cast(substring(reduced_item_code,15,10) as bigint) = 179561971 then 1 else 0 end as item_179561971,
case when cast(substring(reduced_item_code,15,10) as bigint) = 379964706 then 1 else 0 end as item_379964706,
case when cast(substring(reduced_item_code,15,10) as bigint) = 696361815 then 1 else 0 end as item_696361815,
case when cast(substring(reduced_item_code,15,10) as bigint) = 752103114 then 1 else 0 end as item_752103114,
case when cast(substring(reduced_item_code,15,10) as bigint) = 17991132 then 1 else 0 end as item_17991132,
case when cast(substring(reduced_item_code,15,10) as bigint) = 380064712 then 1 else 0 end as item_380064712,
case when cast(substring(reduced_item_code,15,10) as bigint) = 359162076 then 1 else 0 end as item_359162076,
case when cast(substring(reduced_item_code,15,10) as bigint) = 416925185 then 1 else 0 end as item_416925185,
case when cast(substring(reduced_item_code,15,10) as bigint) = 35416952 then 1 else 0 end as item_35416952,
case when cast(substring(reduced_item_code,15,10) as bigint) = 190672872 then 1 else 0 end as item_190672872,
case when cast(substring(reduced_item_code,15,10) as bigint) = 882963898 then 1 else 0 end as item_882963898,
case when cast(substring(reduced_item_code,15,10) as bigint) = 202483690 then 1 else 0 end as item_202483690,
case when cast(substring(reduced_item_code,15,10) as bigint) = 764863795 then 1 else 0 end as item_764863795,
case when cast(substring(reduced_item_code,15,10) as bigint) = 10550695 then 1 else 0 end as item_10550695,
case when cast(substring(reduced_item_code,15,10) as bigint) = 112981488 then 1 else 0 end as item_112981488,
case when cast(substring(reduced_item_code,15,10) as bigint) = 35317555 then 1 else 0 end as item_35317555,
case when cast(substring(reduced_item_code,15,10) as bigint) = 373385241 then 1 else 0 end as item_373385241,
case when cast(substring(reduced_item_code,15,10) as bigint) = 11774687 then 1 else 0 end as item_11774687,
case when cast(substring(reduced_item_code,15,10) as bigint) = 652562809 then 1 else 0 end as item_652562809,
case when cast(substring(reduced_item_code,15,10) as bigint) = 369693633 then 1 else 0 end as item_369693633,
case when cast(substring(reduced_item_code,15,10) as bigint) = 11777685 then 1 else 0 end as item_11777685,
case when cast(substring(reduced_item_code,15,10) as bigint) = 238282084 then 1 else 0 end as item_238282084,
case when cast(substring(reduced_item_code,15,10) as bigint) = 891982982 then 1 else 0 end as item_891982982,
case when cast(substring(reduced_item_code,15,10) as bigint) = 416945182 then 1 else 0 end as item_416945182,
case when cast(substring(reduced_item_code,15,10) as bigint) = 452773854 then 1 else 0 end as item_452773854,
case when cast(substring(reduced_item_code,15,10) as bigint) = 43137443 then 1 else 0 end as item_43137443,
case when cast(substring(reduced_item_code,15,10) as bigint) = 238262081 then 1 else 0 end as item_238262081,
case when cast(substring(reduced_item_code,15,10) as bigint) = 891962980 then 1 else 0 end as item_891962980,
case when cast(substring(reduced_item_code,15,10) as bigint) = 43028216 then 1 else 0 end as item_43028216,
case when cast(substring(reduced_item_code,15,10) as bigint) = 43126479 then 1 else 0 end as item_43126479,
case when cast(substring(reduced_item_code,15,10) as bigint) = 826071715 then 1 else 0 end as item_826071715,
case when cast(substring(reduced_item_code,15,10) as bigint) = 271024938 then 1 else 0 end as item_271024938,
case when cast(substring(reduced_item_code,15,10) as bigint) = 179581973 then 1 else 0 end as item_179581973,
case when cast(substring(reduced_item_code,15,10) as bigint) = 369763644 then 1 else 0 end as item_369763644,
case when cast(substring(reduced_item_code,15,10) as bigint) = 730554344 then 1 else 0 end as item_730554344,
case when cast(substring(reduced_item_code,15,10) as bigint) = 373484017 then 1 else 0 end as item_373484017,
case when cast(substring(reduced_item_code,15,10) as bigint) = 463502472 then 1 else 0 end as item_463502472,
case when cast(substring(reduced_item_code,15,10) as bigint) = 826371666 then 1 else 0 end as item_826371666,
case when cast(substring(reduced_item_code,15,10) as bigint) = 433341134 then 1 else 0 end as item_433341134,
case when cast(substring(reduced_item_code,15,10) as bigint) = 648582044 then 1 else 0 end as item_648582044,
case when cast(substring(reduced_item_code,15,10) as bigint) = 861121724 then 1 else 0 end as item_861121724,
case when cast(substring(reduced_item_code,15,10) as bigint) = 696381817 then 1 else 0 end as item_696381817,
case when cast(substring(reduced_item_code,15,10) as bigint) = 764873794 then 1 else 0 end as item_764873794,
case when cast(substring(reduced_item_code,15,10) as bigint) = 288674914 then 1 else 0 end as item_288674914,
case when cast(substring(reduced_item_code,15,10) as bigint) = 373474014 then 1 else 0 end as item_373474014,
case when cast(substring(reduced_item_code,15,10) as bigint) = 410762864 then 1 else 0 end as item_410762864,
case when cast(substring(reduced_item_code,15,10) as bigint) = 68036500 then 1 else 0 end as item_68036500,
case when cast(substring(reduced_item_code,15,10) as bigint) = 190682877 then 1 else 0 end as item_190682877,
case when cast(substring(reduced_item_code,15,10) as bigint) = 427183352 then 1 else 0 end as item_427183352,
case when cast(substring(reduced_item_code,15,10) as bigint) = 865073846 then 1 else 0 end as item_865073846,
case when cast(substring(reduced_item_code,15,10) as bigint) = 828461681 then 1 else 0 end as item_828461681,
case when cast(substring(reduced_item_code,15,10) as bigint) = 345784107 then 1 else 0 end as item_345784107,
case when cast(substring(reduced_item_code,15,10) as bigint) = 381775064 then 1 else 0 end as item_381775064,
case when cast(substring(reduced_item_code,15,10) as bigint) = 190662873 then 1 else 0 end as item_190662873,
case when cast(substring(reduced_item_code,15,10) as bigint) = 648672039 then 1 else 0 end as item_648672039,
case when cast(substring(reduced_item_code,15,10) as bigint) = 194763335 then 1 else 0 end as item_194763335,
case when cast(substring(reduced_item_code,15,10) as bigint) = 417045220 then 1 else 0 end as item_417045220,
case when cast(substring(reduced_item_code,15,10) as bigint) = 675263042 then 1 else 0 end as item_675263042,
case when cast(substring(reduced_item_code,15,10) as bigint) = 344573094 then 1 else 0 end as item_344573094,
case when cast(substring(reduced_item_code,15,10) as bigint) = 893873009 then 1 else 0 end as item_893873009,
case when cast(substring(reduced_item_code,15,10) as bigint) = 268262788 then 1 else 0 end as item_268262788,
case when cast(substring(reduced_item_code,15,10) as bigint) = 481052499 then 1 else 0 end as item_481052499,
case when cast(substring(reduced_item_code,15,10) as bigint) = 238242082 then 1 else 0 end as item_238242082,
case when cast(substring(reduced_item_code,15,10) as bigint) = 433361110 then 1 else 0 end as item_433361110,
case when cast(substring(reduced_item_code,15,10) as bigint) = 112971485 then 1 else 0 end as item_112971485,
case when cast(substring(reduced_item_code,15,10) as bigint) = 652572808 then 1 else 0 end as item_652572808,
case when cast(substring(reduced_item_code,15,10) as bigint) = 9999 then 1 else 0 end as item_9999,
case when cast(substring(reduced_item_code,15,10) as bigint) = 106281053 then 1 else 0 end as item_106281053,
case when cast(substring(reduced_item_code,15,10) as bigint) = 452783857 then 1 else 0 end as item_452783857,
case when cast(substring(reduced_item_code,15,10) as bigint) = 868864757 then 1 else 0 end as item_868864757,
case when cast(substring(reduced_item_code,15,10) as bigint) = 446583206 then 1 else 0 end as item_446583206,
case when cast(substring(reduced_item_code,15,10) as bigint) = 108071511 then 1 else 0 end as item_108071511,
case when cast(substring(reduced_item_code,15,10) as bigint) = 730504347 then 1 else 0 end as item_730504347,
case when cast(substring(reduced_item_code,15,10) as bigint) = 316583822 then 1 else 0 end as item_316583822,
case when cast(substring(reduced_item_code,15,10) as bigint) = 369073471 then 1 else 0 end as item_369073471,
case when cast(substring(reduced_item_code,15,10) as bigint) = 369043469 then 1 else 0 end as item_369043469,
case when cast(substring(reduced_item_code,15,10) as bigint) = 419895193 then 1 else 0 end as item_419895193,
case when cast(substring(reduced_item_code,15,10) as bigint) = 588382962 then 1 else 0 end as item_588382962,
case when cast(substring(reduced_item_code,15,10) as bigint) = 381765067 then 1 else 0 end as item_381765067,
case when cast(substring(reduced_item_code,15,10) as bigint) = 675273041 then 1 else 0 end as item_675273041,
case when cast(substring(reduced_item_code,15,10) as bigint) = 22788573 then 1 else 0 end as item_22788573,
case when cast(substring(reduced_item_code,15,10) as bigint) = 34007174 then 1 else 0 end as item_34007174,
case when cast(substring(reduced_item_code,15,10) as bigint) = 359182079 then 1 else 0 end as item_359182079,
case when cast(substring(reduced_item_code,15,10) as bigint) = 88283243 then 1 else 0 end as item_88283243,
case when cast(substring(reduced_item_code,15,10) as bigint) = 241582464 then 1 else 0 end as item_241582464,
case when cast(substring(reduced_item_code,15,10) as bigint) = 374184137 then 1 else 0 end as item_374184137,
case when cast(substring(reduced_item_code,15,10) as bigint) = 648682043 then 1 else 0 end as item_648682043,
case when cast(substring(reduced_item_code,15,10) as bigint) = 344222417 then 1 else 0 end as item_344222417,
case when cast(substring(reduced_item_code,15,10) as bigint) = 369083470 then 1 else 0 end as item_369083470,
case when cast(substring(reduced_item_code,15,10) as bigint) = 106271048 then 1 else 0 end as item_106271048,
case when cast(substring(reduced_item_code,15,10) as bigint) = 156272824 then 1 else 0 end as item_156272824,
case when cast(substring(reduced_item_code,15,10) as bigint) = 433871168 then 1 else 0 end as item_433871168,
case when cast(substring(reduced_item_code,15,10) as bigint) = 525961862 then 1 else 0 end as item_525961862,
case when cast(substring(reduced_item_code,15,10) as bigint) = 359262073 then 1 else 0 end as item_359262073,
case when cast(substring(reduced_item_code,15,10) as bigint) = 359482096 then 1 else 0 end as item_359482096,
case when cast(substring(reduced_item_code,15,10) as bigint) = 812063836 then 1 else 0 end as item_812063836,
case when cast(substring(reduced_item_code,15,10) as bigint) = 696371814 then 1 else 0 end as item_696371814,
case when cast(substring(reduced_item_code,15,10) as bigint) = 523161282 then 1 else 0 end as item_523161282,
case when cast(substring(reduced_item_code,15,10) as bigint) = 571251241 then 1 else 0 end as item_571251241,
case when cast(substring(reduced_item_code,15,10) as bigint) = 343682147 then 1 else 0 end as item_343682147,
case when cast(substring(reduced_item_code,15,10) as bigint) = 699474354 then 1 else 0 end as item_699474354,
case when cast(substring(reduced_item_code,15,10) as bigint) = 427163350 then 1 else 0 end as item_427163350,
case when cast(substring(reduced_item_code,15,10) as bigint) = 11776686 then 1 else 0 end as item_11776686,
case when cast(substring(reduced_item_code,15,10) as bigint) = 256074472 then 1 else 0 end as item_256074472,
case when cast(substring(reduced_item_code,15,10) as bigint) = 344332416 then 1 else 0 end as item_344332416,
case when cast(substring(reduced_item_code,15,10) as bigint) = 588752994 then 1 else 0 end as item_588752994, 
case when cast(volume_liters as numeric) is null then 0 else cast(volume_liters as numeric) end as volume_liters
from iowa.___temp
order by store_num, year, month;

drop table if exists iowa.___temp;


drop table if exists iowa.rf_dataset_covariates_indic;
create table iowa.rf_dataset_covariates_indic as
select d.*, 
case when s.county_abd = 'Johnson' then 1 else 0 end as county_Johnson,
case when s.county_abd = 'Linn' then 1 else 0 end as county_Linn,
case when s.county_abd = 'Allamakee' then 1 else 0 end as county_Allamakee,
case when s.county_abd = 'Plymouth' then 1 else 0 end as county_Plymouth,
case when s.county_abd = 'Worth' then 1 else 0 end as county_Worth,
case when s.county_abd = 'Madison' then 1 else 0 end as county_Madison,
case when s.county_abd = 'Marion' then 1 else 0 end as county_Marion,
case when s.county_abd = 'Clarke' then 1 else 0 end as county_Clarke,
case when s.county_abd = 'O''Brien' then 1 else 0 end as county_OBrien,
case when s.county_abd = 'Wright' then 1 else 0 end as county_Wright,
case when s.county_abd = 'Appanoose' then 1 else 0 end as county_Appanoose,
case when s.county_abd = 'Mahaska' then 1 else 0 end as county_Mahaska,
case when s.county_abd = 'Butler' then 1 else 0 end as county_Butler,
case when s.county_abd = 'Clay' then 1 else 0 end as county_Clay,
case when s.county_abd = 'Hardin' then 1 else 0 end as county_Hardin,
case when s.county_abd = 'Story' then 1 else 0 end as county_Story,
case when s.county_abd = 'Audubon' then 1 else 0 end as county_Audubon,
case when s.county_abd = 'Hamilton' then 1 else 0 end as county_Hamilton,
case when s.county_abd = 'Van Buren' then 1 else 0 end as county_Van_Buren,
case when s.county_abd = 'Sac' then 1 else 0 end as county_Sac,
case when s.county_abd = 'Washington' then 1 else 0 end as county_Washington,
case when s.county_abd = 'Black Hawk' then 1 else 0 end as county_Black_Hawk,
case when s.county_abd = 'Webster' then 1 else 0 end as county_Webster,
case when s.county_abd = 'Palo Alto' then 1 else 0 end as county_Palo_Alto,
case when s.county_abd = 'Cedar' then 1 else 0 end as county_Cedar,
case when s.county_abd = 'Monroe' then 1 else 0 end as county_Monroe,
case when s.county_abd = 'Cass' then 1 else 0 end as county_Cass,
case when s.county_abd = 'Mitchell' then 1 else 0 end as county_Mitchell,
case when s.county_abd = 'Clayton' then 1 else 0 end as county_Clayton,
case when s.county_abd = 'Dickinson' then 1 else 0 end as county_Dickinson,
case when s.county_abd = 'Montgomery' then 1 else 0 end as county_Montgomery,
case when s.county_abd = 'Jones' then 1 else 0 end as county_Jones,
case when s.county_abd = 'Muscatine' then 1 else 0 end as county_Muscatine,
case when s.county_abd = 'Carroll' then 1 else 0 end as county_Carroll,
case when s.county_abd = 'Osceola' then 1 else 0 end as county_Osceola,
case when s.county_abd = 'Monona' then 1 else 0 end as county_Monona,
case when s.county_abd = 'Winneshiek' then 1 else 0 end as county_Winneshiek,
case when s.county_abd = 'Jefferson' then 1 else 0 end as county_Jefferson,
case when s.county_abd = 'Guthrie' then 1 else 0 end as county_Guthrie,
case when s.county_abd = 'Kossuth' then 1 else 0 end as county_Kossuth,
case when s.county_abd = 'Floyd' then 1 else 0 end as county_Floyd,
case when s.county_abd = 'Louisa' then 1 else 0 end as county_Louisa,
case when s.county_abd = 'Harrison' then 1 else 0 end as county_Harrison,
case when s.county_abd = 'Lee' then 1 else 0 end as county_Lee,
case when s.county_abd = 'Franklin' then 1 else 0 end as county_Franklin,
case when s.county_abd = 'Jackson' then 1 else 0 end as county_Jackson,
case when s.county_abd = 'Scott' then 1 else 0 end as county_Scott,
case when s.county_abd = 'Clinton' then 1 else 0 end as county_Clinton,
case when s.county_abd = 'Boone' then 1 else 0 end as county_Boone,
case when s.county_abd = 'Warren' then 1 else 0 end as county_Warren,
case when s.county_abd = 'Grundy' then 1 else 0 end as county_Grundy,
case when s.county_abd = 'Pocahontas' then 1 else 0 end as county_Pocahontas,
case when s.county_abd = 'Mills' then 1 else 0 end as county_Mills,
case when s.county_abd = 'Jasper' then 1 else 0 end as county_Jasper,
case when s.county_abd = 'Wayne' then 1 else 0 end as county_Wayne,
case when s.county_abd = 'Ida' then 1 else 0 end as county_Ida,
case when s.county_abd = 'Dallas' then 1 else 0 end as county_Dallas,
case when s.county_abd = 'Fremont' then 1 else 0 end as county_Fremont,
case when s.county_abd = 'Marshall' then 1 else 0 end as county_Marshall,
case when s.county_abd = 'Sioux' then 1 else 0 end as county_Sioux,
case when s.county_abd = 'Adair' then 1 else 0 end as county_Adair,
case when s.county_abd = 'Lucas' then 1 else 0 end as county_Lucas,
case when s.county_abd = 'Adams' then 1 else 0 end as county_Adams,
case when s.county_abd = 'Ringgold' then 1 else 0 end as county_Ringgold,
case when s.county_abd = 'Chickasaw' then 1 else 0 end as county_Chickasaw,
case when s.county_abd = 'Bremer' then 1 else 0 end as county_Bremer,
case when s.county_abd = 'Calhoun' then 1 else 0 end as county_Calhoun,
case when s.county_abd = 'Tama' then 1 else 0 end as county_Tama,
case when s.county_abd = 'Lyon' then 1 else 0 end as county_Lyon,
case when s.county_abd = 'Winnebago' then 1 else 0 end as county_Winnebago,
case when s.county_abd = 'Poweshiek' then 1 else 0 end as county_Poweshiek,
case when s.county_abd = 'Iowa' then 1 else 0 end as county_Iowa,
case when s.county_abd = 'Greene' then 1 else 0 end as county_Greene,
case when s.county_abd = 'Wapello' then 1 else 0 end as county_Wapello,
case when s.county_abd = 'Emmet' then 1 else 0 end as county_Emmet,
case when s.county_abd = 'Howard' then 1 else 0 end as county_Howard,
case when s.county_abd = 'Shelby' then 1 else 0 end as county_Shelby,
case when s.county_abd = 'Davis' then 1 else 0 end as county_Davis,
case when s.county_abd = 'Des Moines' then 1 else 0 end as county_Des_Moines,
case when s.county_abd = 'Buena Vista' then 1 else 0 end as county_Buena_Vista,
case when s.county_abd = 'Pottawattamie' then 1 else 0 end as county_Pottawattamie,
case when s.county_abd = 'Humboldt' then 1 else 0 end as county_Humboldt,
case when s.county_abd = 'Delaware' then 1 else 0 end as county_Delaware,
case when s.county_abd = 'Benton' then 1 else 0 end as county_Benton,
case when s.county_abd = 'Woodbury' then 1 else 0 end as county_Woodbury,
case when s.county_abd = 'Cerro Gordo' then 1 else 0 end as county_Cerro_Gordo,
case when s.county_abd = 'Polk' then 1 else 0 end as county_Polk,
case when s.county_abd = 'Dubuque' then 1 else 0 end as county_Dubuque,
case when s.county_abd = 'Keokuk' then 1 else 0 end as county_Keokuk,
case when s.county_abd = 'Union' then 1 else 0 end as county_Union,
case when s.county_abd = 'Decatur' then 1 else 0 end as county_Decatur,
case when s.county_abd = 'Henry' then 1 else 0 end as county_Henry,
case when s.county_abd = '0' then 1 else 0 end as county_0,
case when s.county_abd = 'Fayette' then 1 else 0 end as county_Fayette,
case when s.county_abd = 'Buchanan' then 1 else 0 end as county_Buchanan,
case when s.county_abd = 'Cherokee' then 1 else 0 end as county_Cherokee,
case when s.county_abd = 'Taylor' then 1 else 0 end as county_Taylor,
case when s.county_abd = 'Page' then 1 else 0 end as county_Page,
case when s.county_abd = 'Hancock' then 1 else 0 end as county_Hancock,
case when s.county_abd = 'Crawford' then 1 else 0 end as county_Crawford,
case when s.sell_gasoline = '0' then 1 else 0 end as sell_gasoline_0,
case when s.sell_gasoline = 'No' then 1 else 0 end as sell_gasoline_No,
case when s.sell_gasoline = 'Yes' then 1 else 0 end as sell_gasoline_Yes, 
case when s.store_type = 'Convenience' then 1 else 0 end as store_type_Convenience,
case when s.store_type = 'Discount' then 1 else 0 end as store_type_Discount,
case when s.store_type = 'Other' then 1 else 0 end as store_type_Other,
case when s.store_type = 'Pharmacy' then 1 else 0 end as store_type_Pharmacy,
case when s.store_type = 'Grocery' then 1 else 0 end as store_type_Grocery,
case when s.store_type = 'Liquor' then 1 else 0 end as store_type_Liquor,
case when s.store_type = '0' then 1 else 0 end as store_type_0,
s.square_footage_whole, s.square_footage_retail, p.state_cost, case when p.state_cost = 0 then 0 else 1 end as available
from iowa.rf_dataset_indic d
left join iowa.price_matrix_month_0001_long p
on cast(d.reduced_item_code as bigint) = p.reduced_item_code
and d.year = p.year
and d.month = p.month
left join iowa.store_info s
on d.store_num = s.store_num_abd
where d.year >= 2015
  and d.month >=7;

alter table iowa.rf_dataset_tops_indic
drop column reduced_item_code

copy (select *
      from iowa.rf_dataset_covariates_indic
      order by store_num, year, month)
to 'C:\Users\JW\Documents\Iowa papers\rf_data_indic.csv'
delimiter ','
csv
header;



--We can aggregate to the top 18 or so SKUs to make the prediction load lighter still
drop table if exists iowa.___temp;
select transpose('iowa.discrete_data_tops_monthly_wide_maxvol', 'iowa.___temp','vertically',
		 'year, month, store_num, max_volume','reduced_item_code',
		 'volume_liters'); 
drop table if exists iowa.rf_dataset_tops_indic;
create table iowa.rf_dataset_tops_indic as 
select year, month, store_num, cast(substring(reduced_item_code,15,10) as bigint) as reduced_item_code,
case when cast(substring(reduced_item_code,15,10) as bigint) = 256084476 then 1 else 0 end as item_256084476,
case when cast(substring(reduced_item_code,15,10) as bigint) = 43028216  then 1 else 0 end as item_43028216,
case when cast(substring(reduced_item_code,15,10) as bigint) = 124081067 then 1 else 0 end as item_124081067,
case when cast(substring(reduced_item_code,15,10) as bigint) = 11777685  then 1 else 0 end as item_11777685,
case when cast(substring(reduced_item_code,15,10) as bigint) = 268272787 then 1 else 0 end as item_268272787,
case when cast(substring(reduced_item_code,15,10) as bigint) = 373484017 then 1 else 0 end as item_373484017,
case when cast(substring(reduced_item_code,15,10) as bigint) = 11788689  then 1 else 0 end as item_11788689,
case when cast(substring(reduced_item_code,15,10) as bigint) = 433361110 then 1 else 0 end as item_433361110,
case when cast(substring(reduced_item_code,15,10) as bigint) = 433381135 then 1 else 0 end as item_433381135,
case when cast(substring(reduced_item_code,15,10) as bigint) = 9999      then 1 else 0 end as item_9999,
case when cast(substring(reduced_item_code,15,10) as bigint) = 648672039 then 1 else 0 end as item_648672039,
case when cast(substring(reduced_item_code,15,10) as bigint) = 359182079 then 1 else 0 end as item_359182079,
case when cast(substring(reduced_item_code,15,10) as bigint) = 363082477 then 1 else 0 end as item_363082477,
case when cast(substring(reduced_item_code,15,10) as bigint) = 433371133 then 1 else 0 end as item_433371133,
case when cast(substring(reduced_item_code,15,10) as bigint) = 112971485 then 1 else 0 end as item_112971485,
case when cast(substring(reduced_item_code,15,10) as bigint) = 363052474 then 1 else 0 end as item_363052474,
case when cast(substring(reduced_item_code,15,10) as bigint) = 35317555  then 1 else 0 end as item_35317555,
case when cast(substring(reduced_item_code,15,10) as bigint) = 35318559  then 1 else 0 end as item_35318559,
case when cast(volume_liters as numeric) is null then 0 else cast(volume_liters as numeric) end as volume_liters
from iowa.___temp
order by store_num, year, month, reduced_item_code;

drop table if exists iowa.rf_dataset_tops_covariates_indic;
create table iowa.rf_dataset_tops_covariates_indic as
select d.*, 
-- case when s.county_abd = 'Johnson' then 1 else 0 end as county_Johnson,
-- case when s.county_abd = 'Linn' then 1 else 0 end as county_Linn,
-- case when s.county_abd = 'Allamakee' then 1 else 0 end as county_Allamakee,
-- case when s.county_abd = 'Plymouth' then 1 else 0 end as county_Plymouth,
-- case when s.county_abd = 'Worth' then 1 else 0 end as county_Worth,
-- case when s.county_abd = 'Madison' then 1 else 0 end as county_Madison,
-- case when s.county_abd = 'Marion' then 1 else 0 end as county_Marion,
-- case when s.county_abd = 'Clarke' then 1 else 0 end as county_Clarke,
-- case when s.county_abd = 'O''Brien' then 1 else 0 end as county_OBrien,
-- case when s.county_abd = 'Wright' then 1 else 0 end as county_Wright,
-- case when s.county_abd = 'Appanoose' then 1 else 0 end as county_Appanoose,
-- case when s.county_abd = 'Mahaska' then 1 else 0 end as county_Mahaska,
-- case when s.county_abd = 'Butler' then 1 else 0 end as county_Butler,
-- case when s.county_abd = 'Clay' then 1 else 0 end as county_Clay,
-- case when s.county_abd = 'Hardin' then 1 else 0 end as county_Hardin,
-- case when s.county_abd = 'Story' then 1 else 0 end as county_Story,
-- case when s.county_abd = 'Audubon' then 1 else 0 end as county_Audubon,
-- case when s.county_abd = 'Hamilton' then 1 else 0 end as county_Hamilton,
-- case when s.county_abd = 'Van Buren' then 1 else 0 end as county_Van_Buren,
-- case when s.county_abd = 'Sac' then 1 else 0 end as county_Sac,
-- case when s.county_abd = 'Washington' then 1 else 0 end as county_Washington,
-- case when s.county_abd = 'Black Hawk' then 1 else 0 end as county_Black_Hawk,
-- case when s.county_abd = 'Webster' then 1 else 0 end as county_Webster,
-- case when s.county_abd = 'Palo Alto' then 1 else 0 end as county_Palo_Alto,
-- case when s.county_abd = 'Cedar' then 1 else 0 end as county_Cedar,
-- case when s.county_abd = 'Monroe' then 1 else 0 end as county_Monroe,
-- case when s.county_abd = 'Cass' then 1 else 0 end as county_Cass,
-- case when s.county_abd = 'Mitchell' then 1 else 0 end as county_Mitchell,
-- case when s.county_abd = 'Clayton' then 1 else 0 end as county_Clayton,
-- case when s.county_abd = 'Dickinson' then 1 else 0 end as county_Dickinson,
-- case when s.county_abd = 'Montgomery' then 1 else 0 end as county_Montgomery,
-- case when s.county_abd = 'Jones' then 1 else 0 end as county_Jones,
-- case when s.county_abd = 'Muscatine' then 1 else 0 end as county_Muscatine,
-- case when s.county_abd = 'Carroll' then 1 else 0 end as county_Carroll,
-- case when s.county_abd = 'Osceola' then 1 else 0 end as county_Osceola,
-- case when s.county_abd = 'Monona' then 1 else 0 end as county_Monona,
-- case when s.county_abd = 'Winneshiek' then 1 else 0 end as county_Winneshiek,
-- case when s.county_abd = 'Jefferson' then 1 else 0 end as county_Jefferson,
-- case when s.county_abd = 'Guthrie' then 1 else 0 end as county_Guthrie,
-- case when s.county_abd = 'Kossuth' then 1 else 0 end as county_Kossuth,
-- case when s.county_abd = 'Floyd' then 1 else 0 end as county_Floyd,
-- case when s.county_abd = 'Louisa' then 1 else 0 end as county_Louisa,
-- case when s.county_abd = 'Harrison' then 1 else 0 end as county_Harrison,
-- case when s.county_abd = 'Lee' then 1 else 0 end as county_Lee,
-- case when s.county_abd = 'Franklin' then 1 else 0 end as county_Franklin,
-- case when s.county_abd = 'Jackson' then 1 else 0 end as county_Jackson,
-- case when s.county_abd = 'Scott' then 1 else 0 end as county_Scott,
-- case when s.county_abd = 'Clinton' then 1 else 0 end as county_Clinton,
-- case when s.county_abd = 'Boone' then 1 else 0 end as county_Boone,
-- case when s.county_abd = 'Warren' then 1 else 0 end as county_Warren,
-- case when s.county_abd = 'Grundy' then 1 else 0 end as county_Grundy,
-- case when s.county_abd = 'Pocahontas' then 1 else 0 end as county_Pocahontas,
-- case when s.county_abd = 'Mills' then 1 else 0 end as county_Mills,
-- case when s.county_abd = 'Jasper' then 1 else 0 end as county_Jasper,
-- case when s.county_abd = 'Wayne' then 1 else 0 end as county_Wayne,
-- case when s.county_abd = 'Ida' then 1 else 0 end as county_Ida,
-- case when s.county_abd = 'Dallas' then 1 else 0 end as county_Dallas,
-- case when s.county_abd = 'Fremont' then 1 else 0 end as county_Fremont,
-- case when s.county_abd = 'Marshall' then 1 else 0 end as county_Marshall,
-- case when s.county_abd = 'Sioux' then 1 else 0 end as county_Sioux,
-- case when s.county_abd = 'Adair' then 1 else 0 end as county_Adair,
-- case when s.county_abd = 'Lucas' then 1 else 0 end as county_Lucas,
-- case when s.county_abd = 'Adams' then 1 else 0 end as county_Adams,
-- case when s.county_abd = 'Ringgold' then 1 else 0 end as county_Ringgold,
-- case when s.county_abd = 'Chickasaw' then 1 else 0 end as county_Chickasaw,
-- case when s.county_abd = 'Bremer' then 1 else 0 end as county_Bremer,
-- case when s.county_abd = 'Calhoun' then 1 else 0 end as county_Calhoun,
-- case when s.county_abd = 'Tama' then 1 else 0 end as county_Tama,
-- case when s.county_abd = 'Lyon' then 1 else 0 end as county_Lyon,
-- case when s.county_abd = 'Winnebago' then 1 else 0 end as county_Winnebago,
-- case when s.county_abd = 'Poweshiek' then 1 else 0 end as county_Poweshiek,
-- case when s.county_abd = 'Iowa' then 1 else 0 end as county_Iowa,
-- case when s.county_abd = 'Greene' then 1 else 0 end as county_Greene,
-- case when s.county_abd = 'Wapello' then 1 else 0 end as county_Wapello,
-- case when s.county_abd = 'Emmet' then 1 else 0 end as county_Emmet,
-- case when s.county_abd = 'Howard' then 1 else 0 end as county_Howard,
-- case when s.county_abd = 'Shelby' then 1 else 0 end as county_Shelby,
-- case when s.county_abd = 'Davis' then 1 else 0 end as county_Davis,
-- case when s.county_abd = 'Des Moines' then 1 else 0 end as county_Des_Moines,
-- case when s.county_abd = 'Buena Vista' then 1 else 0 end as county_Buena_Vista,
-- case when s.county_abd = 'Pottawattamie' then 1 else 0 end as county_Pottawattamie,
-- case when s.county_abd = 'Humboldt' then 1 else 0 end as county_Humboldt,
-- case when s.county_abd = 'Delaware' then 1 else 0 end as county_Delaware,
-- case when s.county_abd = 'Benton' then 1 else 0 end as county_Benton,
-- case when s.county_abd = 'Woodbury' then 1 else 0 end as county_Woodbury,
-- case when s.county_abd = 'Cerro Gordo' then 1 else 0 end as county_Cerro_Gordo,
-- case when s.county_abd = 'Polk' then 1 else 0 end as county_Polk,
-- case when s.county_abd = 'Dubuque' then 1 else 0 end as county_Dubuque,
-- case when s.county_abd = 'Keokuk' then 1 else 0 end as county_Keokuk,
-- case when s.county_abd = 'Union' then 1 else 0 end as county_Union,
-- case when s.county_abd = 'Decatur' then 1 else 0 end as county_Decatur,
-- case when s.county_abd = 'Henry' then 1 else 0 end as county_Henry,
-- case when s.county_abd = '0' then 1 else 0 end as county_0,
-- case when s.county_abd = 'Fayette' then 1 else 0 end as county_Fayette,
-- case when s.county_abd = 'Buchanan' then 1 else 0 end as county_Buchanan,
-- case when s.county_abd = 'Cherokee' then 1 else 0 end as county_Cherokee,
-- case when s.county_abd = 'Taylor' then 1 else 0 end as county_Taylor,
-- case when s.county_abd = 'Page' then 1 else 0 end as county_Page,
-- case when s.county_abd = 'Hancock' then 1 else 0 end as county_Hancock,
-- case when s.county_abd = 'Crawford' then 1 else 0 end as county_Crawford,
case when s.sell_gasoline = '0' then 1 else 0 end as sell_gasoline_0,
case when s.sell_gasoline = 'No' then 1 else 0 end as sell_gasoline_No,
case when s.sell_gasoline = 'Yes' then 1 else 0 end as sell_gasoline_Yes, 
case when s.store_type = 'Convenience' then 1 else 0 end as store_type_Convenience,
case when s.store_type = 'Discount' then 1 else 0 end as store_type_Discount,
case when s.store_type = 'Other' then 1 else 0 end as store_type_Other,
case when s.store_type = 'Pharmacy' then 1 else 0 end as store_type_Pharmacy,
case when s.store_type = 'Grocery' then 1 else 0 end as store_type_Grocery,
case when s.store_type = 'Liquor' then 1 else 0 end as store_type_Liquor,
case when s.store_type = '0' then 1 else 0 end as store_type_0,
s.square_footage_whole, s.square_footage_retail, p.state_cost, case when p.state_cost = 0 then 0 else 1 end as available,
case when r.vendor_num = 434 then 1 else 0 end as vendor_434,
case when r.vendor_num = 380 then 1 else 0 end as vendor_380,
case when r.vendor_num = 115 then 1 else 0 end as vendor_115,
case when r.vendor_num = 55 then 1 else 0 end as vendor_55,
case when r.vendor_num = 260 then 1 else 0 end as vendor_260,
case when r.vendor_num = 421 then 1 else 0 end as vendor_421,
case when r.vendor_num = 259 then 1 else 0 end as vendor_259,
case when r.vendor_num = 297 then 1 else 0 end as vendor_297,
r.bottle_volume,
cast(r.bottle_volume as numeric) * cast(r.pack_size as numeric) as sku_volume,
case when r.true_cat_num = 1081600 then 1 else 0 end as category_1081600,
case when r.true_cat_num = 1062310 then 1 else 0 end as category_1062310,
case when r.true_cat_num = 1031080 then 1 else 0 end as category_1031080,
case when r.true_cat_num = 1011100 then 1 else 0 end as category_1011100,
case when r.true_cat_num = 1011300 then 1 else 0 end as category_1011300,
case when r.true_cat_num = 1012100 then 1 else 0 end as category_1012100
from iowa.rf_dataset_tops_indic d
left join iowa.price_matrix_month_0001_long p
on cast(d.reduced_item_code as bigint) = p.reduced_item_code
and d.year = p.year
and d.month = p.month
left join iowa.store_info s
on d.store_num = s.store_num_abd
left join iowa.product_info r
on r.true_item_code = cast(d.reduced_item_code as bigint);
alter table iowa.rf_dataset_tops_indic
drop column reduced_item_code;

copy (select *
      from iowa.rf_dataset_tops_covariates_indic
      where item_9999 = 0
      order by store_num, year, month)
to 'C:\Users\JW\Documents\Iowa papers\rf_data_tops_indic_nocounty.csv'
delimiter ','
csv
header;